<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>River Forecast System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="GEOGLOWS Hydroviewer">
  <meta name="author" content="Riley Hales PhD">
  <meta name="keywords" content="RFS, River Forecast System, Hydrology, Streamflow, Global, GEOGLOWS, Hydroviewer, Streamflow, Forecast, Retrospective">
  <meta name="robots" content="index, follow">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">

  <!-- CSS Framework -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-3.1.0.min.js" charset="utf-8"></script>
  <!-- ArcGIS JS -->
  <script type="module" src="https://js.arcgis.com/calcite-components/3.2.1/calcite.esm.js"></script>
  <link rel="stylesheet" href="https://js.arcgis.com/4.33/esri/themes/light/main.css"/>
  <script src="https://js.arcgis.com/4.33/"></script>
  <script type="module" src="https://js.arcgis.com/4.33/map-components/"></script>
  <!-- Locale (must load before app module) -->
  <script type="application/javascript" src="/src/json/locales/es.json"></script>
  <!-- App (Vite entry point) -->
  <script type="module" src="/src/main.js"></script>
</head>

<body>
<!-- Settings-->
<div id="about-modal" class="modal">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center">
    <div class="modal-header-bar">
      <h4>Acerca de GEOGLOWS</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <div style="width: 100%; max-width: 800px">
      <p>
        Para obtener más información sobre el proyecto GEOGLOWS, visite <a href="https://www.geoglows.org" target="_blank">geoglows.org</a>.
        Para obtener más información sobre el Sistema de Pronóstico de Ríos (River Forecast System), visite <a href="https://training.geoglows.org" target="_blank">training.geoglows.org</a>.
        Para obtener instrucciones sobre la documentación y descarga de datos, consulte <a href="https://data.geoglows.org" target="_blank">data.geoglows.org</a>.
      </p>
      <p>Más información sobre las capas de mapas de NOAA se puede encontrar en:</p>
      <ol>
        <li>NOAA-20 VIIRS True Color: <a href="https://www.arcgis.com/home/item.html?id=c873f4c13aa54b25b01270df9358dc64" target="_blank">arcgis.com</a></li>
        <li>NOAA-20 VIIRS Water States: <a href="https://www.arcgis.com/home/item.html?id=3695712d28354952923d2a26a176b767" target="_blank">arcgis.com</a></li>
        <li>NOAA-20 VIIRS Thermal Anomalies: <a href="https://www.arcgis.com/home/item.html?id=dece90af1a0242dcbf0ca36d30276aa3" target="_blank">arcgis.com</a></li>
        <li>NOAA GOES Colorized Infrared Weather Satellite (10 minute updates): <a href="https://www.arcgis.com/home/item.html?id=37a875ff3611496883b7ccca97f0f5f4" target="_blank">arcgis.com</a></li>
        <li>NOAA-20 VIIRS Flood Composite: <a href="https://floods.ssec.wisc.edu/products/RIVER-FLDglobal-composite" target="_blank">University of Wisconsin Madison SSEC</a></li>
      </ol>
    </div>
  </div>
</div>
<div id="biascorrectionwarning-modal" class="modal">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center">
    <div class="modal-header-bar">
      <h4>¿Obtener datos corregidos por sesgo?</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <div style="width: 100%; max-width: 800px">
      <p>
        La corrección global de sesgo es un proceso experimental basado en investigación activa y esfuerzos de recopilación de datos. Es posible que descubra comportamientos inesperados
        y datos incorrectos. Estos datos no se recomiendan para aplicaciones de orientación operativa. ¿Está seguro de que desea utilizar datos corregidos por sesgo?
      </p>
      <div style="display: flex; flex-direction: row; justify-content: center; gap: 10px; margin-top: 15px">
        <button class="btn red modal-close waves-effect waves-green btn-flat">No</button>
        <button class="btn green modal-close waves-effect waves-green btn-flat" id="confirm-use-bias-correction">Sí, usar datos corregidos</button>
      </div>
    </div>
  </div>
</div>
<div id="settings-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header-bar">
      <h4>Configuración</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <h5>Opciones de visualización</h5>
    <div class="settings-options-wrapper">
      <label>
        <input type="checkbox" class="filled-in" id="settingsShowSimpleForecast" checked/>
        <span>Mostrar pronósticos simples</span>
      </label>
    </div>
    <div class="settings-options-wrapper">
      <label>
        <input type="checkbox" class="filled-in" id="settingsShowExtraRetroGraphs" checked/>
        <span>Mostrar gráficos adicionales que analizan datos retrospectivos.</span>
      </label>
    </div>
    <h5>Opciones de datos</h5>
    <div class="settings-options-wrapper">
      <label>
        <input type="checkbox" class="filled-in" id="settingsUseBiasCorrected"/>
        <span>Usar pronósticos experimentales corregidos por sesgo </span>
      </label>
    </div>
    <h5>Opciones de caché de datos</h5>
    <button class="btn red clear-cache">Borrar caché de datos</button>
    <button class="btn red delete-all-bookmarks">Borrar todos los marcadores de ríos</button>
  </div>
</div>

<!-- Reports -->
<iframe id="report-pdf-frame" class="hidden-underneath"></iframe>
<div id="report-render-space" class="hidden-underneath"></div>
<div id="report-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header-bar">
      <div class="header-group">
        <h4>Generador de Informes de Ríos</h4>
      </div>
      <div class="header-group">
        <button id="new-report-button" data-tooltip="Start new report" data-position="bottom" class="btn tooltipped" style="margin-inline: 8px" disabled><i class="material-icons">add</i></button>
        <a class="modal-close waves-effect waves-green btn-flat">X</a>
      </div>
    </div>
    <h5>1. Seleccionar Tipo de Informe</h5>
    <div class="report-option-wrapper">
      <label for="report-type-select" id="report-type-select-label">Tipo de Informe:</label>
      <select id="report-type-select" aria-labelledby="report-type-select-label">
        <option value="riverForecasts">Pronósticos de Ríos</option>
      </select>
    </div>
    <div class="report-option-wrapper">
      <label for="report-date-calendar">Fecha del pronóstico:</label>
      <input type="date" id="report-date-calendar" onkeydown="return false" style="max-width: 50%">
    </div>
    <div class="report-option-wrapper">
      <label for="report-river-list-select">Lista de Ríos para el Informe:</label>
      <select id="report-river-list-select">
        <option value="allBookmarks">Todos los Ríos Marcados</option>
      </select>
    </div>
    <div style="width: 100%; display: flex; justify-content: center">
      <button id="generate-report" class="btn" style="display: flex; align-items: center">Generar Informe</button>
    </div>
    <h5>2. Creación del Informe</h5>
    <div>Recopilando Datos:</div>
    <div class="progress-with-label">
      <progress id="report-data-progress" value="0" max="100"></progress>
      <div id="report-data-label">0%</div>
    </div>
    <div>Formateando Informe:</div>
    <div class="progress-with-label">
      <progress id="report-format-progress" value="0" max="100"></progress>
      <div id="report-format-label">0%</div>
    </div>
    <h5>3. Descargar Informe</h5>
    <div style="width: 100%; display: flex; justify-content: center">
      <button id="download-report" class="btn" disabled>Descargar Informe en PDF</button>
    </div>
  </div>
</div>
<div id="bookmarks-modal" class="modal" data-category="river-bookmarks">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center;">
    <div class="modal-header-bar">
      <h4 style="margin: 0">Ríos Marcados</h4>
      <div style="flex-grow: 1"></div>
      <a data-tooltip="Añadir marcador" data-position="bottom" class="btn modal-trigger tooltipped" href="#add-river-bookmark" style="margin-inline: 8px"><i class="material-icons">add</i></a>
      <button data-tooltip="Restaurar marcadores predeterminados" data-position="bottom" class="btn tooltipped" id="restore-bookmarks-button" style="margin-inline: 8px"><i class="material-icons">restore</i></button>
      <button data-tooltip="Eliminar todos los marcadores" data-position="bottom" class="btn tooltipped delete-all-bookmarks" style="margin-inline: 8px"><i class="material-icons">delete_forever</i></button>
      <button class="modal-close waves-effect waves-green btn-flat">X</button>
    </div>
    <div id="bookmarks-table" style="width: 100%">
      <table class="striped responsive-table bordered">
        <thead>
        <tr>
          <th data-field="riverId" style="width: 20%; min-width: 150px; max-width: 200px">ID del Río</th>
          <th data-field="riverName" style="width: 60%; max-width: 450px">Nombre del Río</th>
          <th data-field="actions" style="width: 20%; min-width: 150px; max-width: 200px">Acciones</th>
        </tr>
        </thead>
        <tbody id="bookmarks-tbody">
        </tbody>
      </table>
    </div>
  </div>
</div>
<div id="add-river-bookmark" class="modal" data-category="river-bookmarks">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center; height: 100%">
    <div class="modal-header-bar">
      <h4 style="margin: 0">Añadir un nuevo marcador de río</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <table>
      <thead>
      <tr>
        <th data-field="riverId"><label for="save-river-id">ID del Río</label></th>
        <th data-field="riverName"><label for="save-river-name">Nombre del Río</label></th>
        <th data-field="actions">Acciones</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td data-field="riverId">
          <input id="save-river-id" type="number" contenteditable="true" onchange="this.value = this.value.slice(0, 9)" placeholder="ID del Río (9 dígitos)">
        </td>
        <td data-field="riverName">
          <input id="save-river-name" contenteditable="true" onchange="this.innerText = this.innerText.slice(0, 30)" placeholder="Nombre del Río">
        </td>
        <td data-field="actions">
          <button class="btn green" id="submit-new-bookmark">Añadir marcador</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Data presentation -->
<div id="charts-modal" class="modal always-large-modal">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center; height: 100%">
    <div class="modal-header-bar">
      <div class="header-group">
        <a class="btn btn-flat modal-trigger waves-effect waves-teal tooltipped" data-tooltip="Buscar un río" href="#enter-river-id-modal"><i class="material-icons" style="color: black">search</i></a>
        <h4 id="selected-river-id" style="margin: 0">Seleccione un río</h4>
        <button class="btn-flat" id="save-current-river"></button>
      </div>
      <div class="header-group">
        <button id="showForecastCharts" class="btn status-btn active" onclick="showChartView('forecast')">Pronóstico<span id="forecast-load-icon"></span></button>
        <button id="showRetroCharts" class="btn status-btn" onclick="showChartView('retro')">Histórico<span id="retro-load-icon"></span></button>
        <a class="btn btn-flat waves-effect waves-teal tooltipped dropdown-trigger" data-target="download-select" data-tooltip="Descargar CSVs"><i class="material-icons">download</i></a>
        <ul id="download-select" class="dropdown-content">
          <li style="display: flex; justify-content: center">
            <button class="btn waves-effect waves-light" id="download-forecast-link" disabled>Guardar datos de pronóstico (CSV)</button>
          </li>
          <li style="display: flex; justify-content: center">
            <button class="btn waves-effect waves-light" id="download-retrospective-link" disabled>Guardar datos retrospectivos (CSV)</button>
          </li>
        </ul>
        <button class="btn modal-close waves-effect waves-red btn-flat">X</button>
      </div>
    </div>
    <div class="chart-spaces chart-category-container" style="position: relative; height: 100%">
      <div id="forecastChartSpace" class="chart-category-container">
        <div id="forecast-date-controls">
          <button id="datepicker-previous" class="btn btn-flat"><i class="material-icons">arrow_back</i></button>
          <label for="forecast-date-calendar">Fecha de pronóstico:</label>
          <input type="date" id="forecast-date-calendar" onkeydown="return false">
          <button id="datepicker-next" class="btn btn-flat" disabled><i class="material-icons">arrow_forward</i></button>
        </div>
        <div id="forecastPlot" class="chart">
          <h4>Ingresar un ID del río o usar el mapa para hacer clic en un río y ver los datos del río</h4>
        </div>
        <div id="forecastTable" class="chart"></div>
      </div>
      <div id="retroChartSpace" class="chart-category-container dissolve-backwards">
        <div id="retroPlot" class="chart">
          <h4>Ingresar un ID del río o usar el mapa para hacer clic en un río y ver los datos del río</h4>
        </div>
        <div id="yearlyVolPlot" class="chart"></div>
        <div id="cumVolume" class="chart"></div>
        <div id="yearlyStatusPlot" class="chart"></div>
        <div id="yearlyPeaksPlot" class="chart"></div>
        <div id="rasterHydrographPlot" class="chart"></div>
        <div id="fdcPlot" class="chart"></div>
      </div>
    </div>
  </div>
</div>
<div id="enter-river-id-modal" class="modal" data-category="river-bookmarks">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center; height: 100%">
    <div class="modal-header-bar">
      <h4 style="margin: 0">Buscar un río por ID</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <div style="display: flex; flex-direction: row; align-items: center; gap: 5px; justify-content: center; width: 100%">
      <label for="river-id">ID del Río:</label>
      <input type="number" id="river-id" placeholder="ID del Río (9 dígitos)" onchange="this.value = this.value.slice(0, 9)" style="width: 200px"/>
      <button class="waves-effect waves-light btn" onclick="setRiverIdFromInput()">Entregar</button>
    </div>
  </div>
</div>

<!-- For the Map -->
<div id="filter-modal" data-category="map" class="modal">
  <div class="modal-content">
    <h4>Filtrar Ríos</h4>
    <div><a href="https://livefeeds3.arcgis.com/arcgis/rest/services/GEOGLOWS/GlobalWaterModel_Medium/MapServer/0">Visita ArcGIS Living Atlas</a> para ver metadatos.</div>
    <div style="width: 100%">
      <div>
        <label for="outletCountry">País de Salida del Río</label>
        <select id="outletCountry" class="browser default" multiple></select>
      </div>
      <div>
        <label for="riverCountry">País del Río</label>
        <select id="riverCountry" class="browser default" multiple></select>
      </div>
      <div>
        <label for="vpuSelect">Número de VPU</label>
        <select id="vpuSelect" class="browser default" multiple></select>
      </div>
      <div>
        <label for="definitionString">Ingresar filtros SQL personalizados</label>
        <input type="text" id="definitionString" placeholder=""/>
      </div>
      <div>
        <label for="definition-expression">Definición Actual</label>
        <input type="text" id="definition-expression" disabled/>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn" onclick="updateLayerDefinitions()">Applicar Filtros</button>
    <button class="btn btn-secondary" onclick="resetDefinitionExpression()">Borrar Filtros</button>
    <a class="modal-close waves-effect waves-green btn-flat">Cerrar</a>
  </div>
</div>

<div class="body-wrapper">
  <div class="nav-bar-wrapper">
    <h4 style="font-size: 2rem; font-weight: bolder">
      <span class="hide-on-small-only">GEOGLOWS </span>R<span class="hide-on-small-only">iver </span>F<span class="hide-on-small-only">orecast </span>S<span class="hide-on-small-only">ystem</span>
    </h4>
    <div>
      <a data-tooltip="Mostrar Datos" data-position="bottom" class="btn modal-trigger tooltipped" href="#charts-modal"><i class="material-icons">timeline</i></a>
      <a data-tooltip="Generar Informes" data-position="bottom" class="btn modal-trigger tooltipped" href="#report-modal"><i class="material-icons">assignment</i></a>
      <a data-tooltip="Ríos marcados" data-category="river-bookmarks" data-position="bottom" class="btn modal-trigger tooltipped" href="#bookmarks-modal"><i class="material-icons">bookmark</i></a>
      <a data-tooltip="Sobre Datos" data-position="bottom" class="btn modal-trigger tooltipped" href="#about-modal"><i class="material-icons">help</i></a>
      <a data-tooltip="Configuración" data-position="bottom" class="btn modal-trigger tooltipped" href="#settings-modal"><i class="material-icons">settings</i></a>
      <a data-tooltip="Idioma" data-position="bottom" class="btn dropdown-trigger tooltipped" href="#" data-target="language-select"><i class="material-icons">translate</i></a>
      <ul id="language-select" class="dropdown-content">
        <li><a href="/index.html" data-lang="en-US">English</a></li>
        <li><a href="#" data-lang="es-ES">Español</a></li>
      </ul>
    </div>
  </div>

  <arcgis-map item-id="a69f14ea2e784e019f4a4b6835ffd376">
    <arcgis-zoom position="top-left"></arcgis-zoom>
    <arcgis-locate position="top-left" scale="5000"></arcgis-locate>

    <arcgis-expand close-on-esc position="top-right" title="Layer List">
      <arcgis-layer-list class="large-icon"></arcgis-layer-list>
    </arcgis-expand>
    <arcgis-expand close-on-esc position="top-right" title="Basemap Gallery">
      <arcgis-basemap-gallery></arcgis-basemap-gallery>
    </arcgis-expand>

    <arcgis-expand close-on-esc position="bottom-left" mode="floating" data-tooltip="Legend">
      <arcgis-legend legend-style="classic"></arcgis-legend>
    </arcgis-expand>

    <arcgis-scale-bar position="bottom-right" bar-style="line" unit="dual"></arcgis-scale-bar>
  </arcgis-map>

  <div id="timeSliderForecastWrapper" data-category="map" class="time-sliders">
    <div class="time-slider-title">Pasos de Tiempo del Pronóstico</div>
    <div id="timeSliderForecast"></div>
  </div>
  <div id="timeSliderHydroSOSWrapper" data-category="map" class="time-sliders">
    <div class="time-slider-title">HydroSOS Indicadores de Estado Mensuales</div>
    <div id="timeSliderHydroSOS"></div>
  </div>
</div>
</body>
</html>
