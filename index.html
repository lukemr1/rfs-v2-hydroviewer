<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>River Forecast System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="GEOGLOWS Hydroviewer">
  <meta name="author" content="Riley Hales PhD">
  <meta name="keywords" content="RFS, River Forecast System, Hydrology, Streamflow, Global, GEOGLOWS, Hydroviewer, Streamflow, Forecast, Retrospective">
  <meta name="robots" content="index, follow">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">

  <!-- CSS Framework -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <!-- Vite entry point -->
  <script type="module" src="/src/main.js" defer></script>
</head>

<body>
<!-- Settings-->
<div id="about-modal" class="modal">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center">
    <div class="modal-header-bar">
      <h4 data-i18n="ui.aboutTitle">About</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <div style="width: 100%; max-width: 800px">
      <p data-i18n-html="ui.aboutParagraph">
        To learn more about the GEOGLOWS project, visit <a href="https://www.geoglows.org" target="_blank">geoglows.org</a>.
        For more information about the River Forecast System please visit <a href="https://training.geoglows.org" target="_blank">training.geoglows.org</a>.
        For documentation and data download instructions, please consult <a href="https://data.geoglows.org" target="_blank">data.geoglows.org</a>.
      </p>
      <p data-i18n="ui.aboutNoaaIntro">More information about the NOAA map layers can be found at:</p>
      <ol data-i18n-html="ui.aboutNoaaList">
        <li>NOAA-20 VIIRS True Color: <a href="https://www.arcgis.com/home/item.html?id=c873f4c13aa54b25b01270df9358dc64" target="_blank">arcgis.com</a></li>
        <li>NOAA-20 VIIRS Water States: <a href="https://www.arcgis.com/home/item.html?id=3695712d28354952923d2a26a176b767" target="_blank">arcgis.com</a></li>
        <li>NOAA-20 VIIRS Thermal Anomalies: <a href="https://www.arcgis.com/home/item.html?id=dece90af1a0242dcbf0ca36d30276aa3" target="_blank">arcgis.com</a></li>
        <li>NOAA GOES Colorized Infrared Weather Satellite (10 minute updates): <a href="https://www.arcgis.com/home/item.html?id=37a875ff3611496883b7ccca97f0f5f4" target="_blank">arcgis.com</a></li>
        <li>NOAA-20 VIIRS Flood Composite: <a href="https://floods.ssec.wisc.edu/products/RIVER-FLDglobal-composite" target="_blank">University of Wisconsin Madison SSEC</a></li>
      </ol>
    </div>
  </div>
</div>
<div id="biascorrectionwarning-modal" class="modal">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center">
    <div class="modal-header-bar">
      <h4 data-i18n="ui.biasTitle">Enable Bias Corrected Data?</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <div style="width: 100%; max-width: 800px">
      <p data-i18n="ui.biasParagraph">
        Global bias correction is an experimental feature based on active research and data collection efforts. You might discover unexpected behaviors
        and incorrect data. These data are not recommended for operational guidance applications. Are you sure you want to use bias corrected data?
      </p>
      <div style="display: flex; flex-direction: row; justify-content: center; gap: 10px; margin-top: 15px">
        <button class="btn red modal-close waves-effect waves-green btn-flat" data-i18n="ui.biasNo">No, go back</button>
        <button class="btn green modal-close waves-effect waves-green btn-flat" id="confirm-use-bias-correction" data-i18n="ui.biasYes">Yes, use bias corrected data</button>
      </div>
    </div>
  </div>
</div>
<div id="settings-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header-bar">
      <h4 data-i18n="ui.settingsTitle">Settings</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <h5 data-i18n="ui.chartOptions">Chart Options</h5>
    <div class="settings-options-wrapper">
      <label>
        <input type="checkbox" class="filled-in" id="settingsShowSimpleForecast" checked/>
        <span data-i18n="ui.showSimpleForecast">Display simplified forecast stats</span>
      </label>
    </div>
    <div class="settings-options-wrapper">
      <label>
        <input type="checkbox" class="filled-in" id="settingsShowExtraRetroGraphs" checked/>
        <span data-i18n="ui.showExtraRetroGraphs">Show additional plots analyzing retrospective data</span>
      </label>
    </div>
    <h5 data-i18n="ui.dataOptions">Data Options</h5>
    <div class="settings-options-wrapper">
      <label>
        <input type="checkbox" class="filled-in" id="settingsUseBiasCorrected"/>
        <span data-i18n="ui.useBiasCorrection">Use experimental bias correction</span>
      </label>
    </div>
    <h5 data-i18n="ui.cacheOptions">Browser Cache Options</h5>
    <button class="btn red clear-cache" data-i18n="ui.clearCache">Clear local cache of downloaded data</button>
    <button class="btn red delete-all-bookmarks" data-i18n="ui.deleteAllBookmarks">Remove all bookmarked rivers</button>
  </div>
</div>

<!-- Reports-->
<iframe id="report-pdf-frame" class="hidden-underneath"></iframe>
<div id="report-render-space" class="hidden-underneath"></div>
<div id="report-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header-bar">
      <div class="header-group">
        <h4 data-i18n="ui.reportsTitle">Generate Reports (Beta)</h4>
      </div>
      <div class="header-group">
        <button id="new-report-button" data-i18n-tooltip="ui.newReportTooltip" data-tooltip="Start new report" data-position="bottom" class="btn tooltipped" style="margin-inline: 8px" disabled><i class="material-icons">add</i></button>
        <a class="modal-close waves-effect waves-green btn-flat">X</a>
      </div>
    </div>
    <h5 data-i18n="ui.reportsStep1">1. Select Report Type</h5>
    <div class="report-option-wrapper">
      <label for="report-type-select" id="report-type-select-label" data-i18n="ui.reportTypeLabel">Report Type:</label>
      <select id="report-type-select" aria-labelledby="report-type-select-label">
        <option value="riverForecasts" data-i18n="ui.reportTypeDaily">Daily Forecast Report</option>
      </select>
    </div>
    <div class="report-option-wrapper">
      <label for="report-date-calendar" data-i18n="ui.forecastDateLabel">Date of Forecast Data:</label>
      <input type="date" id="report-date-calendar" onkeydown="return false" style="max-width: 50%">
    </div>
    <div class="report-option-wrapper">
      <label for="report-river-list-select" data-i18n="ui.selectRiverList">Select List of Rivers</label>
      <select id="report-river-list-select">
        <option value="allBookmarks" data-i18n="ui.allBookmarks">All Bookmarks</option>
      </select>
    </div>
    <div style="width: 100%; display: flex; justify-content: center">
      <button id="generate-report" class="btn" style="display: flex; align-items: center" data-i18n="ui.prepareReport">Prepare Report</button>
    </div>
    <h5 data-i18n="ui.reportsStep2">2. Prepare River Data</h5>
    <div data-i18n="ui.downloadData">Download Data:</div>
    <div class="progress-with-label">
      <progress id="report-data-progress" value="0" max="100"></progress>
      <div id="report-data-label">0%</div>
    </div>
    <div data-i18n="ui.formattingReport">Formatting Report:</div>
    <div class="progress-with-label">
      <progress id="report-format-progress" value="0" max="100"></progress>
      <div id="report-format-label">0%</div>
    </div>
    <h5 data-i18n="ui.reportsStep3">3. Download Report</h5>
    <div style="width: 100%; display: flex; justify-content: center">
      <button id="download-report" class="btn" disabled data-i18n="ui.downloadReportPdf">Download Report (PDF)</button>
    </div>
  </div>
</div>
<div id="bookmarks-modal" class="modal" data-category="river-bookmarks">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center;">
    <div class="modal-header-bar">
      <h4 style="margin: 0" data-i18n="ui.savedRivers">Saved Rivers</h4>
      <div style="flex-grow: 1"></div>
      <a data-i18n-tooltip="ui.saveRiverTooltip" data-tooltip="Save River" data-position="bottom" class="btn modal-trigger tooltipped" href="#add-river-bookmark" style="margin-inline: 8px"><i class="material-icons">add</i></a>
      <button data-i18n-tooltip="ui.restoreBookmarksTooltip" data-tooltip="Restore Default Bookmarks" data-position="bottom" class="btn tooltipped" id="restore-bookmarks-button" style="margin-inline: 8px"><i class="material-icons">restore</i></button>
      <button data-i18n-tooltip="ui.deleteAllBookmarksTooltip" data-tooltip="Delete All Bookmarks" data-position="bottom" class="btn tooltipped delete-all-bookmarks" style="margin-inline: 8px"><i class="material-icons">delete_forever</i></button>
      <button class="modal-close waves-effect waves-green btn-flat">X</button>
    </div>
    <div id="bookmarks-table" style="width: 100%">
      <table class="striped responsive-table bordered">
        <thead>
        <tr>
          <th data-field="riverId" style="width: 20%; min-width: 150px; max-width: 200px" data-i18n="ui.riverIdHeader">River ID</th>
          <th data-field="riverName" style="width: 60%; max-width: 450px" data-i18n="ui.riverNameHeader">River Name</th>
          <th data-field="actions" style="width: 20%; min-width: 150px; max-width: 200px" data-i18n="ui.actionsHeader">Actions</th>
        </tr>
        </thead>
        <tbody id="bookmarks-tbody">
        </tbody>
      </table>
    </div>
  </div>
</div>
<div id="add-river-bookmark" class="modal" data-category="river-bookmarks">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center; height: 100%">
    <div class="modal-header-bar">
      <h4 data-i18n="ui.newBookmarkTitle">New River Bookmark</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <table>
      <thead>
      <tr>
        <th data-field="riverId"><label for="save-river-id" data-i18n="ui.riverIdHeader">River ID</label></th>
        <th data-field="riverName"><label for="save-river-name" data-i18n="ui.riverNameHeader">River Name</label></th>
        <th data-field="actions" data-i18n="ui.actionsHeader">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td data-field="riverId">
          <input id="save-river-id" type="number" contenteditable="true" onchange="this.value = this.value.slice(0, 9)" data-i18n-placeholder="ui.ph9DigitId" placeholder="9 Digit River ID">
        </td>
        <td data-field="riverName">
          <input id="save-river-name" contenteditable="true" onchange="this.innerText = this.innerText.slice(0, 30)" data-i18n-placeholder="ui.phRiverName" placeholder="River name">
        </td>
        <td data-field="actions">
          <button class="btn green" id="submit-new-bookmark" data-i18n="ui.addBookmark">Add Bookmark</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Data presentation -->
<div id="charts-modal" class="modal always-large-modal">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center; height: 100%">
    <div class="modal-header-bar">
      <div class="header-group">
        <a class="btn btn-flat modal-trigger waves-effect waves-teal tooltipped" data-i18n-tooltip="ui.searchRiverTooltip" data-tooltip="Search for a river" href="#enter-river-id-modal"><i class="material-icons" style="color: black">search</i></a>
        <h4 id="selected-river-id" style="margin: 0" data-i18n="ui.selectRiver">Select a river</h4>
        <button class="btn-flat" id="save-current-river"></button>
      </div>
      <div class="header-group">
        <button id="showForecastCharts" class="btn status-btn active" onclick="showChartView('forecast')"><span data-i18n="ui.forecastBtn">Forecast</span><span id="forecast-load-icon"></span></button>
        <button id="showRetroCharts" class="btn status-btn" onclick="showChartView('retro')"><span data-i18n="ui.retroBtn">Retrospective</span><span id="retro-load-icon"></span></button>
        <a class="btn btn-flat waves-effect waves-teal tooltipped dropdown-trigger" data-target="download-select" data-i18n-tooltip="ui.downloadCsvsTooltip" data-tooltip="Download CSVs"><i class="material-icons">download</i></a>
        <ul id="download-select" class="dropdown-content">
          <li style="display: flex; justify-content: center">
            <button class="btn waves-effect waves-light" id="download-forecast-link" disabled data-i18n="ui.saveForecastCsv">Save Forecast Data (CSV)</button>
          </li>
          <li style="display: flex; justify-content: center">
            <button class="btn waves-effect waves-light" id="download-retrospective-link" disabled data-i18n="ui.saveRetroCsv">Save Retrospective Data (CSV)</button>
          </li>
        </ul>
        <button class="btn modal-close waves-effect waves-red btn-flat">X</button>
      </div>
    </div>
    <div class="chart-spaces chart-category-container" style="position: relative; height: 100%">
      <div id="forecastChartSpace" class="chart-category-container">
        <div id="forecast-date-controls">
          <button id="datepicker-previous" class="btn btn-flat"><i class="material-icons">arrow_back</i></button>
          <label for="forecast-date-calendar" data-i18n="ui.forecastDateControl">Forecast Date:</label>
          <input type="date" id="forecast-date-calendar" onkeydown="return false">
          <button id="datepicker-next" class="btn btn-flat" disabled><i class="material-icons">arrow_forward</i></button>
        </div>
        <div id="forecastPlot" class="chart">
          <h4 data-i18n="ui.emptyChartPrompt">Enter a River ID or use the map to click on a stream to view data</h4>
        </div>
        <div id="forecastTable" class="chart"></div>
      </div>
      <div id="retroChartSpace" class="chart-category-container dissolve-backwards">
        <div id="retroPlot" class="chart">
          <h4 data-i18n="ui.emptyChartPrompt">Enter a River ID or use the map to click on a stream to view data</h4>
        </div>
        <div id="yearlyVolPlot" class="chart"></div>
        <div id="cumVolume" class="chart"></div>
        <div id="yearlyStatusPlot" class="chart"></div>
        <div id="yearlyPeaksPlot" class="chart"></div>
        <div id="rasterHydrographPlot" class="chart"></div>
        <div id="fdcPlot" class="chart"></div>
      </div>
    </div>
  </div>
</div>
<div id="enter-river-id-modal" class="modal" data-category="river-bookmarks">
  <div class="modal-content" style="display: flex; flex-direction: column; align-items: center; height: 100%">
    <div class="modal-header-bar">
      <h4 data-i18n="ui.enterRiverIdTitle">Enter River ID</h4>
      <a class="modal-close waves-effect waves-green btn-flat">X</a>
    </div>
    <div style="display: flex; flex-direction: row; align-items: center; gap: 5px; justify-content: center; width: 100%">
      <label for="river-id" data-i18n="ui.riverIdLabel">River ID</label>
      <input type="number" id="river-id" data-i18n-placeholder="ui.phEnter9DigitId" placeholder="Enter 9 Digit River ID" onchange="this.value = this.value.slice(0, 9)" style="max-width: 200px"/>
      <button class="waves-effect waves-light btn" onclick="setRiverIdFromInput()" data-i18n="ui.submitBtn">Submit</button>
    </div>
  </div>
</div>

<!-- For the Map -->
<div id="filter-modal" data-category="map" class="modal">
  <div class="modal-content">
    <h4 data-i18n="ui.filterTitle">Filter Streams on Map</h4>
    <div data-i18n-html="ui.filterEsriLink"><a href="https://livefeeds3.arcgis.com/arcgis/rest/services/GEOGLOWS/GlobalWaterModel_Medium/MapServer/0">Visit the Esri Living Atlas</a> for all attribute options</div>
    <div style="width: 100%">
      <div>
        <label for="outletCountry" data-i18n="ui.outletCountryLabel">River Outlet Country</label>
        <select id="outletCountry" class="browser default" multiple></select>
      </div>
      <div>
        <label for="riverCountry" data-i18n="ui.riverCountryLabel">River Country</label>
        <select id="riverCountry" class="browser default" multiple></select>
      </div>
      <div>
        <label for="vpuSelect" data-i18n="ui.vpuLabel">VPU Number</label>
        <select id="vpuSelect" class="browser default" multiple></select>
      </div>
      <div>
        <label for="definitionString" data-i18n="ui.customSqlLabel">Enter Custom SQL Filters</label>
        <input type="text" id="definitionString" placeholder=""/>
      </div>
      <div>
        <label for="definition-expression" data-i18n="ui.currentDefinition">Definition Currently Displayed</label>
        <input type="text" id="definition-expression" disabled/>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn" onclick="updateLayerDefinitions()" data-i18n="ui.applyFilters">Apply Filters</button>
    <button class="btn btn-secondary" onclick="resetDefinitionExpression()" data-i18n="ui.clearFilters">Clear Filters</button>
    <a class="modal-close waves-effect waves-green btn-flat" data-i18n="ui.closeBtn">Close</a>
  </div>
</div>

<div class="body-wrapper">
  <div class="nav-bar-wrapper">
    <h4 style="font-size: 2rem; font-weight: bolder">
      <span class="hide-on-small-only">GEOGLOWS </span>R<span class="hide-on-small-only">iver </span>F<span class="hide-on-small-only">orecast </span>S<span class="hide-on-small-only">ystem</span>
    </h4>
    <div>
      <a data-i18n-tooltip="ui.navViewCharts" data-tooltip="View Charts" data-position="bottom" class="btn modal-trigger tooltipped" href="#charts-modal"><i class="material-icons">timeline</i></a>
      <a data-i18n-tooltip="ui.navReports" data-tooltip="Generate Reports" data-position="bottom" class="btn modal-trigger tooltipped" href="#report-modal"><i class="material-icons">assignment</i></a>
      <a data-i18n-tooltip="ui.navBookmarks" data-tooltip="Saved Rivers" data-category="river-bookmarks" data-position="bottom" class="btn modal-trigger tooltipped" href="#bookmarks-modal"><i class="material-icons">bookmark</i></a>
      <a data-i18n-tooltip="ui.navAbout" data-tooltip="Learn More" data-position="bottom" class="btn modal-trigger tooltipped" href="#about-modal"><i class="material-icons">help</i></a>
      <a data-i18n-tooltip="ui.navSettings" data-tooltip="Settings" data-position="bottom" class="btn modal-trigger tooltipped" href="#settings-modal"><i class="material-icons">settings</i></a>
      <a data-i18n-tooltip="ui.navLanguage" data-tooltip="Language" data-position="bottom" class="btn dropdown-trigger tooltipped" href="#" data-target="language-select"><i class="material-icons">translate</i></a>
      <ul id="language-select" class="dropdown-content">
        <li><a href="#" data-lang="en">English</a></li>
        <li><a href="#" data-lang="es">Español</a></li>
        <li><a href="#" data-lang="fr">Français</a></li>
      </ul>
    </div>
  </div>

  <arcgis-map item-id="a69f14ea2e784e019f4a4b6835ffd376">
    <arcgis-zoom slot="top-left"></arcgis-zoom>
    <arcgis-locate slot="top-left" scale="5000"></arcgis-locate>
    <calcite-action id="filter-button" scale="s" icon="filter" appearance="solid" slot="top-left" data-i18n-title="ui.filterStreamsTitle" title="Filter Streams on Map"></calcite-action>
    <calcite-action id="forecast-time-slider" scale="s" icon="clock" appearance="solid" slot="top-left" data-i18n-title="ui.forecastTimeStepsTitle" title="Stream Layer Forecast Time Steps"></calcite-action>
    <calcite-action id="hydrosos-time-slider" scale="s" appearance="solid" slot="top-left" data-i18n-title="ui.hydrosostimeStepsTitle" title="HydroSOS Monthly Status Indicators"><span>SOS</span></calcite-action>

    <arcgis-expand slot="top-right" data-i18n-title="ui.layerListTitle" title="Layer List">
      <arcgis-layer-list class="large-icon"></arcgis-layer-list>
    </arcgis-expand>
    <arcgis-expand slot="top-right" data-i18n-title="ui.basemapGalleryTitle" title="Basemap Gallery">
      <arcgis-basemap-gallery></arcgis-basemap-gallery>
    </arcgis-expand>

    <arcgis-expand slot="bottom-left" data-i18n-title="ui.legendTitle" title="Legend">
      <arcgis-legend legend-style="classic"></arcgis-legend>
    </arcgis-expand>

    <arcgis-scale-bar slot="bottom-right" bar-style="line" unit="dual"></arcgis-scale-bar>
  </arcgis-map>

  <div id="timeSliderForecastWrapper" data-category="map" class="time-sliders">
    <div class="time-slider-title" data-i18n="ui.tsForecastTitle">Stream Layer Forecast Time Steps</div>
    <div id="timeSliderForecast"></div>
  </div>
  <div id="timeSliderHydroSOSWrapper" data-category="map" class="time-sliders">
    <div class="time-slider-title" data-i18n="ui.tsHydrosostitle">HydroSOS Monthly Status Indicators</div>
    <div id="timeSliderHydroSOS"></div>
  </div>
</div>
</body>
</html>
